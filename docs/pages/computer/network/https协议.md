## 什么是https协议
1. 其实就是在HTTP上加入一层SSL/TSL加密, 利用SSL/TSL加密建立一条加密的通信渠道进行数据传输
![](/computer/screenshot_1554021284977.png)
2. HTTP + 加密 + 认证 + 完整性保护 = HTTPS
3. HTTP先和SSL/TSL通信, 再与TCP通信
4. 那么加密SSL是如何做的呢, 我们需要先了解共享加密(对称加密)和非对称加密
## 共享秘钥(对称加密)
1. 加密和解密都使用同一秘钥
2. 但是很危险如何让攻击者拿到秘钥就可以解密我们传输的数据了
![](/computer/screenshot_1554023271944.png)
## 公钥,私钥加密(非对称加密)
1. 可以使用公钥加密信息, 再用私钥解密
2. 也可以用私钥加密信息, 再用公钥解密
(可以把公钥暴露给前端, 私钥保存在服务器上不可以暴露)
![](/computer/screenshot_1554021586059.png) <br>
(1) 客户端  <-  (从服务端获取公钥)  <-  服务端 <br>
(2) 客户端  ->  (利用公钥, 加密信息, 发给服务器端)  -> 服务端 <br>
(3) 客户端  ->  (服务端利用私钥解密, 得到信息)  ->  服务端 <br>
(这里注意, 私钥是保存在服务器上, 除非你能黑入我的服务器, 获取私钥) 
****
## HTTPS的混合加密方式
但是使用对称加密算法, 要快于非对称加密, 所以能不能综合一下呢, 最好使用一个共享秘钥, 即可加密也可以解密, 但是直接传输这个共享秘钥很危险.所以混合使用上2种方式 <br>
![](/computer/8525388-8978b280967cf9d1.png) <br>
1. 流程如下: <br>
(1) 客户端向服务端请求索要公钥 <br>
(2) 准备好的算法, 随机产生一个对称秘钥, 公钥加密它发给服务器端, 服务端用私钥解密, 得到共享秘钥 <br>
(3) 以后这对前后端就用这个共享秘钥加密和解密信息 <br>
> 黑客伪装成客户端, 也请求公钥, 然后伪造一些致命数据, 发给后端使用就不太好了
## 数字签名
为了保证数据的完整性和正确性, 使用散列算法如SHA1，MD5将传输内容hash一次获得hash值，即摘要。客户端使用服务端的公钥对摘要和信息内容进行加密，然后传输给服务端，服务端使用私钥进行解密获得原始内容和摘要值，这时服务端使用相同的hash算法对原始内容进行hash，然后与摘要值比对，如果一致，说明信息是完整的。反过来也一样
> 但是黑客如果查看了前端代码, 发现了加密的方式, 也伪造生成相同的摘要呢? 我们需要一个CA机构来颁发数字证书

## 数字证书
数字证书是由权威的CA（Certificate Authority）机构给服务端进行颁发，CA机构通过服务端提供的相关信息生成证书, 证书内容包含了持有人的相关信息，服务器的公钥，证书的有效期/创建期等，最重要的是公钥也在数字证书中。  <br>
![](/computer/Snipaste_2020-04-12_00-09-53.png)

## CA工作过程
1. 客户端, 访问IP后, 会先去证书中心机构用机构的线上CA私钥对 (持有人信息, 服务器公钥, 其他信息) 加密一个 数字签名, 返回给客户端, 客户端在请求时, 会带上这个数字证书发给后端
2. 电脑在装载浏览器时, 会自动配置好, 受信任的证书机构的根证书, 在请求证书记录的域名时, 会使用CA下发的具体证书中的公钥加密信息, 发给后端, 后端用CA下发的私钥解密(返过来私钥加密, 前端公钥解密)
3. 而且CA证书里也有有效期, 会验证证书是否过期

## CA遇到的问题
1. 黑客把自己服务器和公钥也去根证书机构申请证书了, 但是后端解密时, 发现这不是我前端自己加密的证书的数据, 系统会提示, 此消息颁发的数字证书是为别人准备的，其他人可能尝试向您发送欺骗的数据，请忽视它, 浏览器提示: 此网站的证书有问题, 建议你不要访问 <br>
2. 在服务器端, 一个证书中含有三个部分:"证书内容，散列算法，加密密文"，证书内容会被散列算法hash计算出hash值，然后使用CA机构提供的私钥进行RSA加密。<br>
3. 当客户端发起请求时，服务器将该数字证书发送给客户端，客户端通过CA机构提供的公钥对加密密文进行解密获得散列值（数字签名），同时将证书内容使用相同的散列算法进行Hash得到另一个散列值，比对两个散列值，如果两者相等则说明证书没问题。开始提取证书里的公钥进行加密/解密使用 <br>

## 使用建议
1. 安全性考虑：
* HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用
* SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行
2. 成本考虑： <br>
(1): SSL证书需要购买申请，功能越强大的证书费用越高 <br>
(2): SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名. <br>
(3): 使用HTTPS协议会使页面的加载时间延长近50%，增加10%到20%的耗电。 <br>
(4): HTTPS连接缓存不如HTTP高效，流量成本高。 <br>
(5): HTTPS连接服务器端资源占用高很多，支持访客多的网站需要投入更大的成本, 握手阶段比较费时, 影响用户体验, 最好像12306普通页面用HTTP, 用户操作页面使用HTTPS